!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).DropdownSelect={})}(this,(function(t){"use strict";class e extends HTMLElement{#t;#e;#i;#n;#s;#o;#r;#d;#c;#a=-1;constructor(){super(),this.setAttribute("aria-hidden","true"),this.#t=this.toggleDropdown.bind(this),this.#e=this.selectOption.bind(this),this.#i=this.handleOutsideClick.bind(this),this.#n=this.handleKeyboardNavigation.bind(this)}connectedCallback(){this.#s=this.querySelector("dropdown-trigger"),this.#o=this.querySelector("input"),this.#r=this.querySelector("dropdown-options"),this.#d=this.querySelectorAll("dropdown-option"),this.#c=this.#s?.querySelector(".dropdown-label"),this.setupAriaAttributes(),this.bindUI(),this.hide()}disconnectedCallback(){this.unbindUI()}setupAriaAttributes(){const t=this.#r,e=this.#s;e.setAttribute("aria-haspopup","listbox"),e.setAttribute("aria-expanded","false"),e.setAttribute("role","combobox"),e.id||(e.id=`dropdown-trigger-${Date.now()}`),t.setAttribute("role","listbox"),t.setAttribute("aria-labelledby",e.id),this.#d.forEach(((t,i)=>{t.setAttribute("role","option"),t.setAttribute("aria-selected","false"),t.setAttribute("tabindex","-1"),t.id=`${e.id}-option-${i}`}))}bindUI(){this.#s.addEventListener("click",this.#t),this.#d.forEach((t=>{t.addEventListener("click",this.#e)}))}unbindUI(){this.#s.removeEventListener("click",this.#t),this.#d.forEach((t=>{t.removeEventListener("click",this.#e)})),document.removeEventListener("click",this.#i),document.removeEventListener("keydown",this.#n)}handleOutsideClick(t){this.contains(t.target)||this.hide()}handleKeyboardNavigation(t){const e=Array.from(this.#d);switch(t.key){case"Escape":t.preventDefault(),this.hide();break;case"ArrowDown":t.preventDefault(),document.activeElement===this.#s&&(this.#a=-1),this.#a<e.length-1&&this.focusOption(this.#a+1);break;case"ArrowUp":t.preventDefault(),this.#a>0?this.focusOption(this.#a-1):0===this.#a&&(this.#s.focus(),this.#a=-1);break;case"Home":t.preventDefault(),this.focusOption(0);break;case"End":t.preventDefault(),this.focusOption(e.length-1);break;case"Enter":case" ":if(t.preventDefault(),"true"===this.getAttribute("aria-hidden")&&document.activeElement===this.#s)return void this.show();this.#a>=0?this.selectOption({target:e[this.#a]}):document.activeElement===this.#s&&this.toggleDropdown();break;default:const i=t.key.toLowerCase();if(1===i.length){const t=e.find((t=>t.textContent.trim().toLowerCase().startsWith(i)));if(t){const i=e.indexOf(t);this.focusOption(i)}}}}focusOption(t){const e=Array.from(this.#d);e.forEach((t=>{t.setAttribute("tabindex","-1")})),e[t]&&(e[t].setAttribute("tabindex","0"),e[t].focus(),this.#a=t)}toggleDropdown(){"true"===this.getAttribute("aria-hidden")?this.show():this.hide()}selectOption(t){const e=t.target.closest("dropdown-option");e&&(this.#d.forEach((t=>{t.setAttribute("aria-selected","false")})),e.setAttribute("aria-selected","true"),this.#o&&(this.#o.value=e.dataset.value||e.textContent.trim()),this.#c&&(this.#c.textContent=e.textContent.trim()),this.dispatchEvent(new CustomEvent("change",{detail:{value:e.dataset.value||e.textContent.trim(),text:e.textContent.trim()},bubbles:!0})),this.hide())}show(){this.setAttribute("aria-hidden","false"),this.#s.setAttribute("aria-expanded","true");const t=Array.from(this.#d).find((t=>"true"===t.getAttribute("aria-selected")));if(t){const e=Array.from(this.#d).indexOf(t);this.focusOption(e)}else this.#d.length>0&&this.focusOption(0);document.addEventListener("click",this.#i),document.addEventListener("keydown",this.#n)}hide(){this.setAttribute("aria-hidden","true"),this.#s.setAttribute("aria-expanded","false"),this.#a=-1,document.removeEventListener("click",this.#i),document.removeEventListener("keydown",this.#n),this.#s.focus()}}class i extends HTMLElement{constructor(){super(),this.setAttribute("tabindex","0")}connectedCallback(){if(!this.querySelector(".dropdown-caret")){const t=document.createElement("span");t.className="dropdown-caret",this.appendChild(t)}}}class n extends HTMLElement{constructor(){super()}}class s extends HTMLElement{constructor(){super()}}customElements.get("dropdown-select")||customElements.define("dropdown-select",e),customElements.get("dropdown-trigger")||customElements.define("dropdown-trigger",i),customElements.get("dropdown-options")||customElements.define("dropdown-options",n),customElements.get("dropdown-option")||customElements.define("dropdown-option",s),t.DropdownOption=s,t.DropdownOptions=n,t.DropdownSelect=e,t.DropdownTrigger=i}));
